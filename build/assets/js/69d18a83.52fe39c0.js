"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[694],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=p(n),c=i,u=h["".concat(s,".").concat(c)]||h[c]||m[c]||o;return n?a.createElement(u,r(r({ref:t},d),{},{components:n})):a.createElement(u,r({ref:t},d))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9790:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>c,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],l={id:"detection_models",title:"Photovoltaic Fault Detector",sidebar_label:"Photovoltaic Fault Detector"},s=void 0,p={unversionedId:"detection_models",id:"detection_models",title:"Photovoltaic Fault Detector",description:"Deep learning application for fault detection in photovoltaic plants. Trained detection models that point out where the panel faults are by using radiometric thermal infrared pictures, as well as a tutorial on how to use these algorithms in your own thermal photos. It also shows a step by step to train these models with its own database, in order to properly adjust the model to its particularity.",source:"@site/../docs/DETECTION_MODELS.md",sourceDirName:".",slug:"/detection_models",permalink:"/simplemap.github.io/docs/detection_models",draft:!1,tags:[],version:"current",lastUpdatedBy:"Alvaro Farias",lastUpdatedAt:1607305780,formattedLastUpdatedAt:"Dec 7, 2020",frontMatter:{id:"detection_models",title:"Photovoltaic Fault Detector",sidebar_label:"Photovoltaic Fault Detector"},sidebar:"docs",previous:{title:"Developers",permalink:"/simplemap.github.io/docs/developers"},next:{title:"Precision Agriculture",permalink:"/simplemap.github.io/docs/precision_agriculture"}},d={},m=[{value:"Quickstart",id:"quickstart",level:2},{value:"Example to use trained model",id:"example-to-use-trained-model",level:3},{value:"Model Detection",id:"model-detection",level:3},{value:"Type of Data",id:"type-of-data",level:3},{value:"Training",id:"training",level:3},{value:"1. Data preparation",id:"1-data-preparation",level:4},{value:"2. Edit the configuration file",id:"2-edit-the-configuration-file",level:4},{value:"3. Start the training process",id:"3-start-the-training-process",level:4},{value:"4. Perform detection using trained weights on image, set of images",id:"4-perform-detection-using-trained-weights-on-image-set-of-images",level:4},{value:"Evaluation",id:"evaluation",level:3},{value:"Weights of Trained Models",id:"weights-of-trained-models",level:3}],h={toc:m};function c(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Deep learning application for fault detection in photovoltaic plants. Trained detection models that point out where the panel faults are by using radiometric thermal infrared pictures, as well as a tutorial on how to use these algorithms in your own thermal photos. It also shows a step by step to train these models with its own database, in order to properly adjust the model to its particularity."),(0,o.kt)("h2",{id:"quickstart"},"Quickstart"),(0,o.kt)("p",null,"In the root project execute the following command to install all dependencies project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install -r requirements.txt\n")),(0,o.kt)("p",null,"You need install Jupyter notebook to see the code example. You can find the installation documentation for the ",(0,o.kt)("a",{parentName:"p",href:"https://jupyter.readthedocs.io/en/latest/install.html"},"Jupyter platform, on ReadTheDocs")," or in github page ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jupyter/notebook"},"here"),"."),(0,o.kt)("p",null,"For a local installation, make sure you have pip installed and run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install notebook\n")),(0,o.kt)("h3",{id:"example-to-use-trained-model"},"Example to use trained model"),(0,o.kt)("p",null,"In ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/RentadroneCL/model-definition/blob/master/Example_prediction.ipynb"},"'Example_Prediction'")," this is the example of how to implement an already trained model, it can be modified to change the model you have to use and the image in which you want to detect faults."),(0,o.kt)("p",null,"In ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/RentadroneCL/model-definition/blob/master/Example%20Detection%20AllInOne.ipynb"},"'Example Prediction AllInOne'")," this is the example of how implement all trained model, you can use this code for predict a folder of images and have a output image with detection boxes."),(0,o.kt)("p",null,"In ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/RentadroneCL/model-definition/blob/master/Example_prediction_Ortofoto.ipynb"},"'Example_Prediction_Orthophoto'")," this is the example of how implement all trained model, you can use this code for predict a Orthophot and have a output image with detection boxes."),(0,o.kt)("h3",{id:"model-detection"},"Model Detection"),(0,o.kt)("p",null,"The models used for detection are SSD ",(0,o.kt)("a",{parentName:"p",href:"https://arxiv.org/abs/1512.02325"},"SSD: Single Shot MultiBox Detector")," and YOLOv3 ","[YOLOv3: An Incremental Improvement]"," (",(0,o.kt)("a",{parentName:"p",href:"https://arxiv.org/abs/1804.02767"},"https://arxiv.org/abs/1804.02767"),"), they are imported from the following repositories:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/pierluigiferrari/ssd_keras#how-to-fine-tune-one-of-the-trained-models-on-your-own-dataset"},"SSD_Keras")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/experiencor/keras-yolo3"},"YOLOv3_Keras"))),(0,o.kt)("p",null,"Grab the pretrained weights of SSD and  YOLO3 from ",(0,o.kt)("a",{parentName:"p",href:"https://drive.google.com/drive/folders/1LSc9FkAwJrAAT8pAUWz8aax_biFAMMXS?usp=sharing"},"Drive_Weights")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"center"},"Model"),(0,o.kt)("th",{parentName:"tr",align:"center"},"Pretrained Weights"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"SSD7/SSD300"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1VHTx28tGI94yFqwT_WHp-xkx_8Hh_A31"},"Weight VGG16"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"YOLO3"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1cnCQHl-TnOrwb-leug1I0O9vMBaSwJLt"},"Weight Full Yolo3"))))),(0,o.kt)("h3",{id:"type-of-data"},"Type of Data"),(0,o.kt)("p",null,"The images used for the design of this model were extracted by air analysis, specifically: FLIR aerial radiometric thermal infrared pictures, taken by UAV (R-JPEG format). Which were converted into .jpg images for the training of these detection models.\nExample FLIR image:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/RentadroneCL/model-definition/raw/master/images/example_flir.jpg",alt:"FLIR"})),(0,o.kt)("p",null,"Same image in .jpg format:"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/RentadroneCL/model-definition/raw/master/images/example.jpg",alt:"JPG"})),(0,o.kt)("h3",{id:"training"},"Training"),(0,o.kt)("h4",{id:"1-data-preparation"},"1. Data preparation"),(0,o.kt)("p",null,"View folder Train&Test_A/ and Train&Test_S/, example of panel anns and soiling fault anns."),(0,o.kt)("p",null,"Organize the dataset into 4 folders:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"train_image_folder <= the folder that contains the train images.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"train_annot_folder <= the folder that contains the train annotations in VOC format.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"valid_image_folder <= the folder that contains the validation images.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"valid_annot_folder <= the folder that contains the validation annotations in VOC format."))),(0,o.kt)("p",null,"There is a one-to-one correspondence by file name between images and annotations.\nFor create own data set use LabelImg code from :\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tzutalin/labelImg"},"https://github.com/tzutalin/labelImg")),(0,o.kt)("h4",{id:"2-edit-the-configuration-file"},"2. Edit the configuration file"),(0,o.kt)("p",null,"The configuration file for YOLO3 is a json file, which looks like this  (example soiling fault ):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "model" : {\n    "min_input_size": 400,\n    "max_input_size": 400,\n    "anchors": [5,7, 10,14, 15, 15, 26,32, 45,119, 54,18, 94,59, 109,183, 200,21],\n    "labels": ["1"],\n    "backend": "full_yolo_backend.h5"\n  },\n  "train": {\n    "train_image_folder": "../Train&Test_S/Train/images/",\n    "train_annot_folder": "../Train&Test_S/Train/anns/",\n    "cache_name": "../Experimento_fault_1/Resultados_yolo3/full_yolo/experimento_fault_1_gpu.pkl",\n    "train_times": 1,\n    "batch_size": 2,\n    "learning_rate": 1e-4,\n    "nb_epochs": 200,\n    "warmup_epochs": 15,\n    "ignore_thresh": 0.5,\n    "gpus": "0,1",\n    "grid_scales": [1,1,1],\n    "obj_scale": 5,\n    "noobj_scale": 1,\n    "xywh_scale": 1,\n    "class_scale": 1,\n    "tensorboard_dir": "log_experimento_fault_gpu",\n    "saved_weights_name": "../Experimento_fault_1/Resultados_yolo3/full_yolo/experimento_yolo3_full_fault.h5",\n    "debug": true\n  },\n  "valid": {\n    "valid_image_folder": "../Train&Test_S/Test/images/",\n    "valid_annot_folder": "../Train&Test_S/Test/anns/",\n    "cache_name": "../Experimento_fault_1/Resultados_yolo3/full_yolo/val_fault_1.pkl",\n    "valid_times": 1\n  },\n  "test": {\n    "test_image_folder": "../Train&Test_S/Test/images/",\n    "test_annot_folder": "../Train&Test_S/Test/anns/",\n    "cache_name": "../Experimento_fault_1/Resultados_yolo3/full_yolo/test_fault_1.pkl",\n    "test_times": 1\n  }\n}\n')),(0,o.kt)("p",null,"The configuration file for SSD300 is a json file, which looks like this  (example soiling fault ) and .txt with name of images (train.txt):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "model" : {\n    "backend": "ssd300",\n    "input": 400,\n    "labels": ["1"]\n  },\n  "train": {\n    "train_image_folder": "Train&Test_S/Train/images",\n    "train_annot_folder": "Train&Test_S/Train/anns",\n    "train_image_set_filename": "Train&Test_S/Train/train.txt",\n    "train_times": 1,\n    "batch_size": 12,\n    "learning_rate": 1e-4,\n    "warmup_epochs": 3,\n    "nb_epochs": 100,\n    "saved_weights_name": "Result_ssd300_fault_1/experimento_ssd300_fault_1.h5",\n    "debug": true\n  },\n  "valid": {\n    "valid_image_folder": "../Train&Test_D/Test/images/",\n    "valid_annot_folder": "../Train&Test_D/Test/anns/",\n    "valid_image_set_filename": "../Train&Test_D/Test/test.txt"\n  },\n  "test": {\n    "test_image_folder": "Train&Test_S/Test/images",\n    "test_annot_folder": "Train&Test_S/Test/anns",\n    "test_image_set_filename": "Train&Test_S/Test/test.txt"\n  }\n}\n')),(0,o.kt)("h4",{id:"3-start-the-training-process"},"3. Start the training process"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"python train_ssd.py -c config.json -o /path/to/result")),(0,o.kt)("p",null,"or\n",(0,o.kt)("inlineCode",{parentName:"p"},"python train_ssd.py -c config.json -o /path/to/result")),(0,o.kt)("p",null,'By the end of this process, the code will write the weights of the best model to file best_weights.h5 (or whatever name specified in the setting "saved_weights_name" in the config.json file). The training process stops when the loss on the validation set is not improved in 20 consecutive epoches.'),(0,o.kt)("h4",{id:"4-perform-detection-using-trained-weights-on-image-set-of-images"},"4. Perform detection using trained weights on image, set of images"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"python predict_ssd.py -c config.json -i /path/to/image/or/video -o /path/output/result"),"\nor\n",(0,o.kt)("inlineCode",{parentName:"p"},"python predict_yolo.py -c config.json -i /path/to/image/or/video -o /path/output/result")),(0,o.kt)("p",null,"It carries out detection on the image and write the image with detected bounding boxes to the same folder."),(0,o.kt)("h3",{id:"evaluation"},"Evaluation"),(0,o.kt)("p",null,"The evaluation is integrated into the training process, if you want to do the independent evaluation you must go to the folder ssd_keras-master or keras-yolo3-master and use the following code"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"python evaluate.py -c config.json")),(0,o.kt)("p",null,"Compute the mAP performance of the model defined in ",(0,o.kt)("inlineCode",{parentName:"p"},"saved_weights_name")," on the validation dataset defined in ",(0,o.kt)("inlineCode",{parentName:"p"},"valid_image_folder")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"valid_annot_folder"),"."),(0,o.kt)("h3",{id:"weights-of-trained-models"},"Weights of Trained Models"),(0,o.kt)("p",null,"All of weights of this trained model grab from ",(0,o.kt)("a",{parentName:"p",href:"https://drive.google.com/drive/folders/1LSc9FkAwJrAAT8pAUWz8aax_biFAMMXS?usp=sharing"},"Drive_Weights")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:"center"},"Model"),(0,o.kt)("th",{parentName:"tr",align:"center"},"Weights Trained"),(0,o.kt)("th",{parentName:"tr",align:"center"},"Config"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"SSD7 Panel"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1qNjfAp9sW1VJh8ewnb3NKuafhZockTqV"},"weight")),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://github.com/RentadroneCL/model-definition/blob/master/Result_ssd7_panel/config_7_panel.json"},"config"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"SSD300 Soiling"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1IiOyYW8yPAh4IALbM_ZVqRhLdxV-ZSPw"},"weight")),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://github.com/RentadroneCL/model-definition/blob/master/config_300_fault_1.json"},"config"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"YOLO3 Panel"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=14zgtgDJv3KTvhRC-VOz6sqsGPC_bdrL1"},"weight")),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://github.com/RentadroneCL/model-definition/blob/master/config_full_yolo_panel_infer.json"},"config"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"YOLO3 Soiling"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1YLgkn1wL5xAGOpwd2gzdfsJVGYPzszn-"},"weight")),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://github.com/RentadroneCL/model-definition/blob/master/config_full_yolo_fault_1_infer.json"},"config"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"YOLO3 Diode"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1VUtrK9JVTbzBw5dX7_dgLTMToFHbAJl1"},"weight")),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://github.com/RentadroneCL/model-definition/blob/master/config_full_yolo_fault_4_infer.json"},"config"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:"center"},"YOLO3 Affected Cell"),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://drive.google.com/open?id=1ngyCzw7xF0N5oZnF29EIS5LOl1PFkRRM"},"weight")),(0,o.kt)("td",{parentName:"tr",align:"center"},(0,o.kt)("a",{parentName:"td",href:"https://github.com/RentadroneCL/model-definition/blob/master/config_full_yolo_fault_2_infer.json"},"config"))))),(0,o.kt)("p",null,"The image used are specified in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/RentadroneCL/model-definition/blob/master/Training_Images.xlsx"},"Table images"),".\nYou can see some examples in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/RentadroneCL/model-definition/blob/master/README_Result.md"},"Summary of results"),"."))}c.isMDXComponent=!0}}]);